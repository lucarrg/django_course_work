{% extends 'coworking/base.html' %}

{% block title %}
{% if booking %}Редактировать бронирование{% else %}Забронировать{% endif %}
{% endblock %}

{% block content %}
<h1>
{% if booking %}Редактировать бронирование{% else %}Забронировать рабочее место{% endif %}
</h1>

<p><strong>Рабочее место:</strong> {{ workplace.name }}</p>
<p><strong>Коворкинг:</strong> {{ workplace.coworking.name }}</p>
<p><strong>Цена за час:</strong> {{ workplace.price_per_hour }} ₽</p>

<h3>Занятые часы</h3>
{% if busy_by_date %}
    {% for date_str, hours in busy_by_date.items %}
        <div class="busy-date">
            <strong>{{ date_str }}:</strong>
            {% for hour in hours %}
                <span class="busy-hour">{{ hour }}:00</span>{% if not forloop.last %}, {% endif %}
            {% endfor %}
        </div>
    {% endfor %}
{% else %}
<p>Все часы свободны</p>
{% endif %}

<hr>

<form method="post">
    {% csrf_token %}
    {{ form.non_field_errors }}

    <div class="form-group">
        <label for="{{ form.date_start.id_for_label }}">{{ form.date_start.label }}</label>
        {{ form.date_start }}
        {{ form.date_start.errors }}
    </div>

    <div class="form-group">
        <label for="{{ form.start_hour.id_for_label }}">{{ form.start_hour.label }}</label>
        {{ form.start_hour }}
        {{ form.start_hour.errors }}
    </div>

    <div class="form-group">
        <label for="{{ form.date_end.id_for_label }}">{{ form.date_end.label }}</label>
        {{ form.date_end }}
        {{ form.date_end.errors }}
    </div>

    <div class="form-group">
        <label for="{{ form.end_hour.id_for_label }}">{{ form.end_hour.label }}</label>
        {{ form.end_hour }}
        {{ form.end_hour.errors }}
    </div>

    {% if form.cleaned_data.total_price %}
    <div class="total-price">
        <strong>Стоимость бронирования:</strong> {{ form.cleaned_data.total_price }} ₽
    </div>
    {% endif %}

    <div class="form-actions">
        <button type="submit" class="btn btn-primary">
            {% if booking %}Сохранить{% else %}Забронировать{% endif %}
        </button>
        <a href="{% url 'coworking:booking_list' %}" class="btn btn-secondary">Отмена</a>
    </div>
</form>
{% endblock %}